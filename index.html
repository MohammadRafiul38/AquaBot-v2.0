<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AquaBot</title>
  <style>
    body { margin: 0; font-family: Arial, sans-serif; background: #111; color: white; }
    .tabs { display: flex; background: #222; }
    .tab { flex: 1; padding: 12px; text-align: center; cursor: pointer; background: #333; border: 1px solid #444; }
    .tab.active { background: #0a84ff; }
    .tab-content { display: none; padding: 20px; }
    .tab-content.active { display: block; }

    #map { height: 500px; border-radius: 8px; }

    #chatbox { height: 400px; border: 1px solid #444; padding: 10px; overflow-y: auto; background: #1a1a1a; }
    #chat-input { width: 80%; padding: 8px; }
    #send-btn { padding: 8px; background: #0a84ff; border: none; color: white; cursor: pointer; }

    .msg { margin: 8px 0; }
    .user { color: #0af; }
    .bot { color: #0f0; }
  </style>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
</head>
<body>
  <h1 style="text-align:center; padding: 10px;">ðŸŒŠ AquaBot â€“ Smart Flood Assistant</h1>

  <!-- Tabs -->
  <div class="tabs">
    <div class="tab active" onclick="openTab('map-tab')">ðŸ—º Map</div>
    <div class="tab" onclick="openTab('weather-tab')">ðŸŒ¤ Weather & Tide</div>
    <div class="tab" onclick="openTab('chatbot-tab')">ðŸ¤– Chatbot</div>
  </div>

  <!-- Map Tab -->
  <div id="map-tab" class="tab-content active">
    <h2>Interactive Flood Map</h2>
    <div id="map"></div>
  </div>

  <!-- Weather & Tide Tab -->
  <div id="weather-tab" class="tab-content">
    <h2>Real-time Weather & Tide</h2>
    <div id="weather-info">Loading weather...</div>
    <hr>
    <div id="tide-info">Loading tide info...</div>
  </div>

  <!-- Chatbot Tab -->
  <div id="chatbot-tab" class="tab-content">
    <h2>AquaBot Assistant</h2>
    <div id="chatbox"></div>
    <input id="chat-input" type="text" placeholder="Ask AquaBot..." />
    <button id="send-btn">Send</button>
  </div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <script>
    // --- Tab Switch ---
    function openTab(tabId) {
      document.querySelectorAll('.tab-content').forEach(div => div.classList.remove('active'));
      document.querySelectorAll('.tab').forEach(btn => btn.classList.remove('active'));
      document.getElementById(tabId).classList.add('active');
      event.target.classList.add('active');
    }

    // --- Map ---
    var map = L.map('map').setView([40.7128, -74.0060], 12); // NYC
    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
      attribution: '&copy; OpenStreetMap contributors &copy; CARTO',
      subdomains: 'abcd',
      maxZoom: 19
    }).addTo(map);

    // --- Weather + Tide ---
    const WEATHER_KEY = "YOUR_OPENWEATHERMAP_API_KEY";
    const TIDE_KEY = "YOUR_WORLDTIDES_API_KEY";
    const CITY = "New York";
    const LAT = 40.7128, LON = -74.0060;

    async function loadWeather() {
      try {
        let url = `https://api.openweathermap.org/data/2.5/weather?q=${CITY}&units=metric&appid=${WEATHER_KEY}`;
        let res = await fetch(url);
        let data = await res.json();

        document.getElementById("weather-info").innerHTML = `
          <p><b>Temperature:</b> ${data.main.temp} Â°C</p>
          <p><b>Condition:</b> ${data.weather[0].description}</p>
          <p><b>Humidity:</b> ${data.main.humidity}%</p>
        `;
      } catch (e) {
        document.getElementById("weather-info").innerText = "âš  Could not fetch weather.";
      }
    }

    async function loadTide() {
      try {
        let url = `https://www.worldtides.info/api/v3?extremes&lat=${LAT}&lon=${LON}&key=${TIDE_KEY}`;
        let res = await fetch(url);
        let data = await res.json();

        let tides = data.extremes.map(t => 
          `<p><b>${new Date(t.date).toLocaleString()}</b>: ${t.type} (${t.height.toFixed(2)} m)</p>`
        ).join("");

        document.getElementById("tide-info").innerHTML = tides;
      } catch (e) {
        document.getElementById("tide-info").innerText = "âš  Could not fetch tide data.";
      }
    }

    // --- Chatbot ---
    const chatbox = document.getElementById("chatbox");
    document.getElementById("send-btn").addEventListener("click", sendMessage);

    function sendMessage() {
      const input = document.getElementById("chat-input");
      const msg = input.value.trim();
      if (!msg) return;

      chatbox.innerHTML += `<div class="msg user">ðŸ§‘: ${msg}</div>`;
      input.value = "";

      let reply = getBotReply(msg.toLowerCase());
      chatbox.innerHTML += `<div class="msg bot">ðŸ¤– AquaBot: ${reply}</div>`;
      chatbox.scrollTop = chatbox.scrollHeight;
    }

    function getBotReply(msg) {
      if (msg.includes("flood")) return "Stay alert ðŸš¨. Avoid low-lying areas and move to higher ground.";
      if (msg.includes("tide")) return "High tides usually occur twice a day ðŸŒŠ. Check the Tide tab for live info.";
      if (msg.includes("rain")) return "Heavy rainfall may cause flash flooding. Stay indoors if possible.";
      if (msg.includes("hello") || msg.includes("hi")) return "Hello ðŸ‘‹ I'm AquaBot, your flood safety assistant!";
      return "Iâ€™m not sure about that ðŸ¤”, but stay safe near water!";
    }

    // --- Init ---
    window.onload = () => {
      loadWeather();
      loadTide();
    };
  </script>
</body>
</html>
